package tejastore;

import javax.persistence.Query;
import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;

import org.datanucleus.metadata.PersistenceUnitMetaData;
import org.datanucleus.api.jpa.JPAEntityManagerFactory;

public class DBHandler {
	static EntityManagerFactory emf;
	
	DBHandler(){
		
	}
	
	public static EntityManager OpenConnection(){
		PersistenceUnitMetaData pumd = new PersistenceUnitMetaData("dynamic-unit", "RESOURCE_LOCAL", null);
		pumd.addClassName("tejastore.Articulo");
		pumd.setExcludeUnlistedClasses();
		pumd.addProperty("javax.persistence.jdbc.url", "jdbc:postgresql://localhost:5432/postgres");
		pumd.addProperty("javax.persistence.jdbc.driver", "org.postgresql.Driver");
		pumd.addProperty("javax.persistence.jdbc.user", "postgres");
		pumd.addProperty("javax.persistence.jdbc.password", "postgres");
		pumd.addProperty("datanucleus.schema.autoCreateAll", "true");
		emf = new JPAEntityManagerFactory(pumd, null);
		EntityManager em= emf.createEntityManager();
		Query q = em.createNativeQuery("SET search_path='tejastore'");
		Object r=q.getSingleResult();
		System.out.println(r);
		return em;
	}
	
	public static void closeConnection(EntityManagerFactory em){
		em.close();
	}
	

}
	

